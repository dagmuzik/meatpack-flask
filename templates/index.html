<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>SneakerHunter</title>
<style>
    body { font-family: sans-serif; padding: 20px; background: #fff; }
    form, .filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    label { font-weight: bold; }
    input, button { padding: 6px; border-radius: 4px; border: 1px solid #ccc; }
    button { background: black; color: white; border: none; cursor: pointer; }
    button:hover { background: #333; }
    .btn-tab { margin-bottom: 20px; }
    .card-container { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 40px; }
    .card { width: 220px; border: 1px solid #ccc; border-radius: 8px; box-shadow: 2px 2px 6px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; }
    .card img { width: 100%; height: auto; max-height: 240px; object-fit: contain; }
    .card-body { padding: 10px; font-size: 14px; }
    .card-body h4 { margin: 0 0 6px; }
    .card-body .original { text-decoration: line-through; color: #888; }
    .card-body .descuento { color: red; font-weight: bold; }
    .card-body .btn, .favorito-btn {
      margin-top: 8px; display: inline-block; padding: 6px 12px; border-radius: 4px; text-align: center;
      text-decoration: none; background: black; color: white;
    }
    .favorito-btn { background: gold; color: black; border: none; cursor: pointer; }
    @media (max-width: 768px) {
      .card-container { justify-content: center; }
      .card { width: 100%; max-width: 300px; }
    }
  </style>
</head>
<body>
<div style="text-align: center; margin-bottom: 30px;">
<img alt="SneakerHunter Logo" src="static/img/sneakerhunter_logo_only.png" style="width: 240px; border-radius: 10px;"/>
<h1>SneakerHunter</h1>
<p style="color: #555;">El radar que te muestra las mejores opciones en Guatemala</p>
</div>
<div class="btn-tab">
<button onclick="mostrarFavoritos()">üß° Ver favoritos</button>
<button onclick="volverABusqueda()">üîç Volver a b√∫squeda</button>
</div>
<div class="filters">
<strong>Talla:</strong>
  {% for t in ["7", "8", "9", "9.5", "10", "10.5", "11"] %}
    <a href="?talla={{ t }}" style="margin-right:5px;">[{{ t }}]</a>
  {% endfor %}
</div>
<div class="filters">
<strong>Precio:</strong>
<a href="?min_price=0&amp;max_price=399">[&lt; Q400]</a>
<a href="?min_price=400&amp;max_price=700">[Q400‚Äì700]</a>
<a href="?min_price=701&amp;max_price=1000">[Q700‚Äì1000]</a>
<a href="?min_price=1001&amp;max_price=9999">[&gt; Q1000]</a>
</div>
<h2>¬øQu√© quer√©s buscar hoy?</h2>
<form method="post">
<label for="talla">Talla:</label>
<input name="talla" placeholder="Ej. 9.5" type="text" value="{{ talla or '' }}"/>
<label for="min_price">Precio m√≠nimo:</label>
<input name="min_price" step="0.01" type="number" value="{{ min_price or '' }}"/>
<label for="max_price">Precio m√°ximo:</label>
<input name="max_price" step="0.01" type="number" value="{{ max_price or '' }}"/>
<button type="submit">Buscar</button>
</form>
<div id="resultados">
<div class="card-container">
    {% for p in productos %}
      <div class="card">
<img alt="{{ p.nombre }}" src="{{ p.imagen }}"/>
<div class="card-body">
<h4>{{ p.marca }}</h4>
<p>{{ p.nombre }}</p>
<p><strong>Q{{ '%.2f' | format(p.precio_final) }}</strong></p>
          {% if p.precio_original %}
            <p class="original">Antes: Q{{ '%.2f' | format(p.precio_original) }}</p>
          {% endif %}
          {% if p.descuento %}
            <p class="descuento">{{ p.descuento }} OFF</p>
          {% endif %}
          <p>Talla: {{ p.talla }}</p>
<p>Tienda: {{ p.tienda }}</p>
<a class="btn" href="{{ p.url }}" target="_blank">Ver producto</a>
<button class="favorito-btn" onclick="guardarFavorito('{{ p.url }}')">‚≠ê Guardar</button>
</div>
</div>
    {% endfor %}
  </div>
</div>
<div id="favoritos" style="display: none;">
<h2>Mis favoritos</h2>
<div class="card-container" id="cards-favoritos"></div>
</div>
<script>
  function guardarFavorito(url) {
    let favoritos = JSON.parse(localStorage.getItem('favoritos') || '[]');
    if (!favoritos.includes(url)) {
      favoritos.push(url);
      localStorage.setItem('favoritos', JSON.stringify(favoritos));
      alert("Producto guardado como favorito");
    } else {
      alert("Ya est√° en favoritos");
    }
  }

  function mostrarFavoritos() {
    let favoritos = JSON.parse(localStorage.getItem('favoritos') || '[]');
    if (!favoritos.length) {
      alert("No ten√©s productos guardados.");
      return;
    }

    document.getElementById("resultados").style.display = "none";
    document.getElementById("favoritos").style.display = "block";

    let contenedor = document.getElementById("cards-favoritos");
    contenedor.innerHTML = favoritos.map(url => `
      <div class="card">
        <img src="https://via.placeholder.com/220x200?text=Sneaker" alt="Favorito">
        <div class="card-body">
          <h4>Favorito</h4>
          <p><a href="${url}" target="_blank" class="btn">Ver producto</a></p>
        </div>
      </div>
    `).join('');
  }

  function volverABusqueda() {
    document.getElementById("favoritos").style.display = "none";
    document.getElementById("resultados").style.display = "block";
  }
</script>
<div id="popup-tip" style="display:none; position:fixed; bottom:20px; right:20px; background:white; border:1px solid #ccc; padding:15px 20px; border-radius:8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); max-width: 300px; z-index:9999;"><span onclick="cerrarTip()" style="position:absolute; top:5px; right:10px; cursor:pointer; font-weight:bold;">√ó</span><p id="contenido-tip" style="margin:0; font-size:14px; color:#333;"></p></div><script>
// Tips aleatorios y recordatorio de talla
const tips = [
  "¬øSab√≠as que los New Balance suelen tallar media talla m√°s grande?",
  "Tip: Los adidas Forum suelen ser ajustados, mejor media talla arriba.",
  "Nike y Jordan suelen tallar est√°ndar, pero revis√° cada modelo.",
  "Consejo: En Salomon, el ajuste puede variar si es modelo trail o urbano.",
  "¬øCompr√°s sin probar? Verific√° la equivalencia en CM, no solo US."
];

window.addEventListener('DOMContentLoaded', function () {
  // Mostrar tip aleatorio si no se cerr√≥ antes
  if (!sessionStorage.getItem('tipCerrado')) {
    setTimeout(() => {
      const randomTip = tips[Math.floor(Math.random() * tips.length)];
      document.getElementById('contenido-tip').textContent = randomTip;
      document.getElementById('popup-tip').style.display = 'block';
    }, 5000);
  }

  // Autocompletar talla desde cookie
  const tallaInput = document.querySelector("input[name='talla']");
  const tallaCookie = document.cookie.split("; ").find(row => row.startsWith("talla="));
  if (tallaInput && tallaCookie) {
    tallaInput.value = decodeURIComponent(tallaCookie.split("=")[1]);
  }

  // Guardar cookie cuando cambia la talla
  if (tallaInput) {
    tallaInput.addEventListener("change", function () {
      document.cookie = "talla=" + encodeURIComponent(tallaInput.value) + "; path=/; max-age=" + 60*60*24*30;
    });
  }
});

function cerrarTip() {
  document.getElementById('popup-tip').style.display = 'none';
  sessionStorage.setItem('tipCerrado', '1');
}
</script></body>
</html>
